<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#F7941D">
    <title>LINE Bot è¨­å®š - æ½®æ¬£å°å¹«æ‰‹</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- 7-11 é¢¨æ ¼ Header -->
    <header class="header">
        <div class="header-stripes">
            <div class="stripe-orange"></div>
            <div class="stripe-green"></div>
            <div class="stripe-red"></div>
        </div>
        <div class="header-content">
            <span class="header-back" onclick="location.href='/'">â†</span>
            <h1>ğŸ¤– LINE Bot è¨­å®š</h1>
            <p class="subtitle">è¨­å®šè‡ªå‹•æé†’</p>
        </div>
    </header>

    <div class="container">
        <!-- ç›®å‰ç‹€æ…‹ -->
        <div class="settings-section" id="statusSection">
            <h3>ğŸ“Š ç›®å‰ç‹€æ…‹</h3>
            <div id="statusContent">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">æª¢æŸ¥ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- LINE Bot è¨­å®šè¡¨å–® -->
        <div class="settings-section">
            <h3>ğŸ”§ LINE Bot è¨­å®š</h3>
            
            <div class="form-group">
                <label>Channel Secret</label>
                <input type="password" id="channelSecret" placeholder="å¾ LINE Developers è¤‡è£½">
                <p class="helper-text">åœ¨ LINE Developers çš„ Basic settings ä¸­å–å¾—</p>
            </div>
            
            <div class="form-group">
                <label>Channel Access Token</label>
                <input type="password" id="channelAccessToken" placeholder="å¾ LINE Developers è¤‡è£½">
                <p class="helper-text">åœ¨ LINE Developers çš„ Messaging API ä¸­å–å¾—</p>
            </div>
            
            <div class="form-group">
                <label>ç¾¤çµ„ IDï¼ˆé¸å¡«ï¼‰</label>
                <input type="text" id="groupId" placeholder="C1234567890abcdef...">
                <p class="helper-text">LINE ç¾¤çµ„çš„ IDï¼Œç”¨æ–¼ç™¼é€æé†’è¨Šæ¯</p>
            </div>

            <button class="btn btn-primary" id="saveBtn">
                ğŸ’¾ å„²å­˜è¨­å®š
            </button>
        </div>

        <!-- æ¸¬è©¦å€å¡Š -->
        <div class="settings-section">
            <h3>ğŸ§ª æ¸¬è©¦é€£ç·š</h3>
            
            <button class="btn btn-outline" id="testConnectionBtn" style="margin-bottom: 12px;">
                ğŸ”— æ¸¬è©¦ Bot é€£ç·š
            </button>
            
            <button class="btn btn-outline" id="testMessageBtn">
                ğŸ“¤ ç™¼é€æ¸¬è©¦è¨Šæ¯åˆ°ç¾¤çµ„
            </button>
        </div>

        <!-- è¨­å®šæ•™å­¸ -->
        <div class="settings-section">
            <h3>ğŸ“– è¨­å®šæ•™å­¸</h3>
            
            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                <p style="margin-bottom: 12px; font-weight: 600; color: var(--seven-orange);">æ­¥é©Ÿ 1ï¼šå»ºç«‹ LINE Bot</p>
                <ol style="padding-left: 20px; margin-bottom: 20px; line-height: 1.8;">
                    <li>å‰å¾€ <a href="https://developers.line.biz/" target="_blank" style="color: var(--seven-green);">LINE Developers</a></li>
                    <li>å»ºç«‹ Provider å’Œ Messaging API Channel</li>
                    <li>è¤‡è£½ Channel Secret å’Œ Channel Access Token</li>
                </ol>
                
                <p style="margin-bottom: 12px; font-weight: 600; color: var(--seven-orange);">æ­¥é©Ÿ 2ï¼šåŠ å…¥ç¾¤çµ„</p>
                <ol style="padding-left: 20px; margin-bottom: 20px; line-height: 1.8;">
                    <li>å»ºç«‹ LINE ç¾¤çµ„ï¼Œé‚€è«‹åº—å“¡åŠ å…¥</li>
                    <li>æƒæ Bot çš„ QR Code åŠ å…¥ç¾¤çµ„</li>
                    <li>å–å¾—ç¾¤çµ„ ID ä¸¦å¡«å…¥ä¸Šæ–¹æ¬„ä½</li>
                </ol>
                
                <p style="margin-bottom: 12px; font-weight: 600; color: var(--seven-orange);">æ­¥é©Ÿ 3ï¼šè¨­å®š Webhook</p>
                <ol style="padding-left: 20px; line-height: 1.8;">
                    <li>åœ¨ LINE Developers è¨­å®š Webhook URL</li>
                    <li>URL æ ¼å¼ï¼š<code style="background: var(--gray-100); padding: 2px 6px; border-radius: 4px;">https://ä½ çš„ç¶²åŸŸ/webhook</code></li>
                    <li>é–‹å•Ÿã€ŒUse webhookã€é¸é …</li>
                </ol>
            </div>
        </div>

        <!-- ç‰ˆæ¬Šè²æ˜ -->
        <div class="copyright">
            <p class="copyright-brand">æ½®æ¬£å°å¹«æ‰‹</p>
            <p>ä¾¿åˆ©å•†åº—ç”Ÿé®®å“æ•ˆæœŸç®¡ç†ç³»çµ±</p>
            <p class="copyright-notice">Â© 2026 ç‹é€¸å› ç‰ˆæ¬Šæ‰€æœ‰<br>æœªç¶“æˆæ¬Šç¦æ­¢è¤‡è£½ã€ä¿®æ”¹æˆ–å•†æ¥­ä½¿ç”¨</p>
            <p class="copyright-contact">æˆæ¬Šæ´½è©¢ï¼šHour Light International Co., Ltd.</p>
        </div>
    </div>

    <script src="/js/app.js"></script>
    <script>
        async function loadStatus() {
            const statusContent = document.getElementById('statusContent');
            
            try {
                const settings = await loadLineSettings();
                
                let statusHtml = '<div style="display: flex; flex-direction: column; gap: 12px;">';
                
                statusHtml += `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-200);">
                        <span>Channel Secret</span>
                        <span style="color: ${settings.hasChannelSecret ? 'var(--seven-green)' : 'var(--seven-red)'};">
                            ${settings.hasChannelSecret ? 'âœ… å·²è¨­å®š' : 'âŒ æœªè¨­å®š'}
                        </span>
                    </div>
                `;
                
                statusHtml += `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-200);">
                        <span>Access Token</span>
                        <span style="color: ${settings.hasAccessToken ? 'var(--seven-green)' : 'var(--seven-red)'};">
                            ${settings.hasAccessToken ? 'âœ… å·²è¨­å®š' : 'âŒ æœªè¨­å®š'}
                        </span>
                    </div>
                `;
                
                statusHtml += `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                        <span>ç¾¤çµ„ ID</span>
                        <span style="color: ${settings.hasGroupId ? 'var(--seven-green)' : 'var(--seven-orange)'};">
                            ${settings.hasGroupId ? 'âœ… ' + settings.groupId : 'âš ï¸ æœªè¨­å®š'}
                        </span>
                    </div>
                `;
                
                statusHtml += '</div>';
                
                statusContent.innerHTML = statusHtml;
            } catch (error) {
                statusContent.innerHTML = '<p class="text-muted">ç„¡æ³•è¼‰å…¥ç‹€æ…‹</p>';
            }
        }

        document.getElementById('saveBtn').addEventListener('click', async () => {
            const settings = {
                channel_secret: document.getElementById('channelSecret').value,
                channel_access_token: document.getElementById('channelAccessToken').value,
                group_id: document.getElementById('groupId').value || null
            };

            if (!settings.channel_secret || !settings.channel_access_token) {
                showToast('è«‹å¡«å¯« Channel Secret å’Œ Access Token', 'error');
                return;
            }

            const success = await saveLineSettings(settings);
            if (success) {
                loadStatus();
                document.getElementById('channelSecret').value = '';
                document.getElementById('channelAccessToken').value = '';
            }
        });

        document.getElementById('testConnectionBtn').addEventListener('click', async () => {
            const btn = document.getElementById('testConnectionBtn');
            btn.disabled = true;
            btn.textContent = 'æ¸¬è©¦ä¸­...';

            await testLineBot();

            btn.disabled = false;
            btn.textContent = 'ğŸ”— æ¸¬è©¦ Bot é€£ç·š';
        });

        document.getElementById('testMessageBtn').addEventListener('click', async () => {
            const btn = document.getElementById('testMessageBtn');
            btn.disabled = true;
            btn.textContent = 'ç™¼é€ä¸­...';

            await sendTestMessage();

            btn.disabled = false;
            btn.textContent = 'ğŸ“¤ ç™¼é€æ¸¬è©¦è¨Šæ¯åˆ°ç¾¤çµ„';
        });

        loadStatus();
    </script>
</body>
</html>
